<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Hydration Pro Clinical â€” Smart Web</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Almarai:wght@700;900&display=swap');

body {
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background: radial-gradient(circle at bottom center, #00ffff 0%, #0500aa 40%, #000000 100%);
  font-family:'Almarai', sans-serif;
  color:#00ffff;
  padding:10px;
  box-sizing:border-box;
}

.container {
  background: rgba(0,0,0,0.25);
  border-radius: 25px;
  box-shadow: 0 0 20px 6px aqua, 0 0 40px 14px #00ffffaa;
  width: 100%;
  max-width: 700px;
  height: 75vh;
  overflow:hidden;
  display:flex;
  flex-direction: column;
  padding: 20px;
  box-sizing:border-box;
}

.inner-container {
  padding: 10px;
  overflow-y: auto;
  height: 100%;
  scrollbar-width: none;
}
.inner-container::-webkit-scrollbar { width:0; }

.question, .result-card, .schedule-card {
  margin-bottom:15px;
  font-size:1rem;
  display:flex;
  flex-direction: column;
  transform: translateY(20px);
  opacity:0;
  transition: all 0.4s ease;
}

.question.show, .result-card.show, .schedule-card.show {
  transform: translateY(0);
  opacity:1;
}

.input-container {
  position: relative;
  width: 100%;
}

.input-container input,
.input-container select {
  padding: 12px 10px;
  width: 100%;
  border-radius: 8px;
  border: 2px solid #00ffff;
  background: rgba(0,0,0,0.25);
  color: #00ffff;
  font-size: 1rem;
  outline: none;
  box-sizing: border-box;
}

.input-container input::placeholder {
  color: rgba(0,255,255,0.6);
  font-size:0.9rem;
}

.input-container select option {
  background: #000;
  color: #00ffff;
}

.result-card, .schedule-card {
  background: rgba(0,0,0,0.4);
  border-radius:15px;
  padding:15px;
  font-size:1rem;
  line-height:1.5;
  position: relative;
}

/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±Ø·ÙŠØ¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ */
#scheduleCard {
  padding: 18px;
  border-radius: 14px;
  background: #000; /* Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ */
  box-shadow: 0 0 20px purple, inset 0 0 30px purple; /* Ø¸Ù„ Ø¨Ù†ÙØ³Ø¬ÙŠ */
  color: #00ffff; /* Ù†Øµ Ø£ÙˆÙƒÙˆØ§ */
  font-family: Arial, sans-serif; /* Ø®Ø· Ø¨Ø³ÙŠØ· */
}
#scheduleCard span { color: #00ffff; }

.download-btn {
  margin-top: 12px;
  align-self: center;
  background: rgba(0,0,0,0.6);
  border: 2px solid #00ffff;
  border-radius: 50%;
  width: 52px;
  height: 52px;
  font-size: 20px;
  color: #00ffff;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: 0.18s;
  user-select: none;
}
.download-btn:hover { background: #00ffff; color: #000; transform: translateY(-3px); }

.download-btn.busy { opacity: 0.7; transform: scale(0.98); pointer-events: none; }

@media (max-width:480px) {
  .container { height: auto; padding: 15px; }
  .question, .result-card, .schedule-card { font-size: 0.9rem; }
  .input-container input, .input-container select { font-size: 0.9rem; padding: 10px 8px; }
  .download-btn { width:48px; height:48px; font-size:18px; }
}
</style>
</head>
<body>
<div class="container">
  <div class="inner-container" id="questionContainer"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
// === Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ===
const questions = [
  {text:"Ø§Ù„Ø¹Ù…Ø± (Ø³Ù†ÙˆØ§Øª)", type:"number", min:1, max:120},
  {text:"Ø§Ù„Ø¬Ù†Ø³", type:"select", options:["Ø°ÙƒØ±","Ø§Ù†Ø«Ù‰"]},
  {text:"Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)", type:"number", min:10, max:300},
  {text:"Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)", type:"number", min:50, max:250},
  {text:"Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯Ù‡ÙˆÙ† ÙÙŠ Ø§Ù„Ø¬Ø³Ù… (%)", type:"number", min:0, max:70, default:0},
  {text:"Ù†ÙˆØ¹ Ø§Ù„Ø±ÙŠØ§Ø¶Ø©", type:"select", options:["Ø¬Ø±ÙŠ","ÙƒØ§Ø±Ø¯ÙŠÙˆ","Ù‚ÙˆØ©","hiit","Ø³Ø¨Ø§Ø­Ø©","Ù…Ø®ØªÙ„Ø·","Ø¢Ø®Ø±Ù‰"], default:"Ù…Ø®ØªÙ„Ø·"},
  {text:"Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§", type:"number", min:0, max:14, default:3},
  {text:"Ù…ØªÙˆØ³Ø· Ù…Ø¯Ø© Ø§Ù„ØªÙ…Ø±ÙŠÙ† (Ø¯Ù‚ÙŠÙ‚Ø©)", type:"number", min:0, max:300, default:45},
  {text:"Ø´Ø¯Ø© Ø§Ù„ØªÙ…Ø±ÙŠÙ† (RPE 1-10)", type:"number", min:1, max:10, default:6},
  {text:"Ù‡Ù„ ØªØ³ØªØ·ÙŠØ¹ Ù‚ÙŠØ§Ø³ Ø§Ù„ØªØ¹Ø±Ù‚ØŸ", type:"select", options:["Ù†Ø¹Ù…","Ù„Ø§"], default:"Ù„Ø§"},
  {text:"Ø§Ù„ÙˆØ²Ù† Ù‚Ø¨Ù„ Ø§Ù„ØªÙ…Ø±ÙŠÙ† (ÙƒØ¬Ù…)", type:"number", min:10, max:300, condition:(a)=>a[9]==="Ù†Ø¹Ù…"},
  {text:"Ø§Ù„ÙˆØ²Ù† Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠÙ† (ÙƒØ¬Ù…)", type:"number", min:10, max:300, condition:(a)=>a[9]==="Ù†Ø¹Ù…"},
  {text:"Ù…Ø¯Ø© Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø¹Ù†Ø¯ Ø§Ù„Ù‚ÙŠØ§Ø³ (Ø¯Ù‚ÙŠÙ‚Ø©)", type:"number", min:1, max:300, condition:(a)=>a[9]==="Ù†Ø¹Ù…"},
  {text:"ÙƒÙ… Ù„ØªØ± Ø´Ø±Ø¨Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠÙ†ØŸ", type:"number", min:0, max:5, step:0.1, default:0, condition:(a)=>a[9]==="Ù†Ø¹Ù…"},
  {text:"Ù‡Ù„ Ù„Ø¯ÙŠÙƒ ØªØ­Ø§Ù„ÙŠÙ„ Ø¯Ù…/Ø¨ÙˆÙ„ Ø­Ø¯ÙŠØ«Ø©ØŸ", type:"select", options:["Ù†Ø¹Ù…","Ù„Ø§"], default:"Ù„Ø§"},
  {text:"Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙˆØ¯ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø¯Ù… (mmol/L)", type:"number", min:120, max:160, condition:(a)=>a[14]==="Ù†Ø¹Ù…"},
  {text:"Ø£Ø³Ù…ÙˆÙ„ÙŠØ© Ø§Ù„Ø¨ÙˆÙ„ (mOsm/kg)", type:"number", min:0, max:1500, condition:(a)=>a[14]==="Ù†Ø¹Ù…"},
  {text:"ÙƒØ±ÙŠØ§ØªÙŠÙ†ÙŠÙ† (mg/dL)", type:"number", min:0, max:20, condition:(a)=>a[14]==="Ù†Ø¹Ù…"},
  {text:"Ù‡Ù„ ØªØªÙ†Ø§ÙˆÙ„ Ù…Ø¯Ø±Ø§Øª Ø¨ÙˆÙ„ØŸ", type:"select", options:["Ù†Ø¹Ù…","Ù„Ø§"], default:"Ù„Ø§"},
  {text:"Ø£Ø³Ù…Ø§Ø¡ Ø£Ø¯ÙˆÙŠØ© Ù…Ù‡Ù…Ø© Ø£Ø®Ø±Ù‰", type:"text"},
  {text:"Ù…ÙƒÙ…Ù„Ø§Øª ØªØªÙ†Ø§ÙˆÙ„Ù‡Ø§", type:"text"},
  {text:"ÙƒÙ… Ù…Ù„Ù„ÙŠÙ„ØªØ± Ù…Ù† Ø§Ù„ÙƒØ§ÙÙŠÙŠÙ† ÙŠÙˆÙ…ÙŠÙ‹Ø§ØŸ", type:"number", min:0, max:1000, default:0},
  {text:"ÙƒÙ… Ù„ØªØ± Ù…Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©/Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ„Ø§ÙŠØª ÙŠÙˆÙ…ÙŠÙ‹Ø§ØŸ", type:"number", min:0, max:5, default:0},
  {text:"ÙƒÙ… Ù„ØªØ± Ù…Ø§Ø¡ Ø¹Ø§Ø¯ÙŠ ØªØ´Ø±Ø¨ ÙŠÙˆÙ…ÙŠÙ‹Ø§ ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ØŸ", type:"number", min:0, max:5, default:1},
  {text:"Ù†Ø³Ø¨Ø© Ø§Ù„ÙÙˆØ§ÙƒÙ‡ ÙˆØ§Ù„Ø®Ø¶Ø§Ø± Ù…Ù† Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØºØ°Ø§Ø¦ÙŠ (%)", type:"number", min:0, max:100, default:30},
  {text:"ÙƒÙ… ÙˆØ¬Ø¨Ø© Ù…Ø§Ù„Ø­Ø©/Ù…ØµÙ†Ù‘Ø¹Ø© ÙŠÙˆÙ…ÙŠÙ‹Ø§ØŸ", type:"number", min:0, max:10, default:1},
  {text:"Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ù…Ø­ÙŠØ·Ø© (Â°Ù…)", type:"number", min:-10, max:60, default:25},
  {text:"Ù†Ø³Ø¨Ø© Ø§Ù„Ø±Ø·ÙˆØ¨Ø© (%)", type:"number", min:0, max:100, default:50},
  {text:"Ø§Ù„ØªÙ…Ø±ÙŠÙ† ÙÙŠ Ø§Ù„Ù‡ÙˆØ§Ø¡ Ø§Ù„Ø·Ù„Ù‚ØŸ", type:"select", options:["Ù†Ø¹Ù…","Ù„Ø§"], default:"Ù„Ø§"},
  {text:"ÙƒÙ… Ø³Ø§Ø¹Ø© ØªÙ†Ø§Ù… Ù„ÙŠÙ„Ù‹Ø§ØŸ", type:"number", min:0, max:12, default:7},
  {text:"Ù‡Ù„ ØªØ³ØªÙŠÙ‚Ø¸ Ø¹Ø·Ø´Ø§Ù†Ù‹Ø§ Ù„ÙŠÙ„Ù‹Ø§ØŸ", type:"select", options:["Ù†Ø¹Ù…","Ù„Ø§"], default:"Ù„Ø§"},
  {text:"Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯ÙˆØ±Ø© (Ø¥Ù†Ø§Ø« ÙÙ‚Ø·)", type:"select", options:["Ø­ÙŠØ¶","Ø¨ÙˆÙŠØ¶Ø©","Ù„Ø§","ØºÙŠØ±_Ù…Ø·Ø¨Ù‚"], condition:(a)=>a[1]==="Ø§Ù†Ø«Ù‰", default:"Ù„Ø§"},
  {text:"Ù‡Ù„ ØªØµÙˆÙ… Ø­Ø§Ù„ÙŠÙ‹Ø§ØŸ", type:"select", options:["Ù†Ø¹Ù…","Ù„Ø§"], default:"Ù„Ø§"},
  {text:"Ù„ÙˆÙ† Ø§Ù„Ø¨ÙˆÙ„ ØµØ¨Ø§Ø­Ù‹Ø§/Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠÙ†", type:"select", options:["Ø´ÙØ§Ù","ÙØ§ØªØ­","ØºØ§Ù…Ù‚"], default:"ÙØ§ØªØ­"},
  {text:"ÙƒÙ… Ù…Ø±Ø© ØªØªØ¨ÙˆÙ„ ÙŠÙˆÙ…ÙŠÙ‹Ø§ØŸ", type:"number", min:0, max:20, default:6},
  {text:"Ù‡Ù„ ØªØªØ¨ÙˆÙ„ Ù„ÙŠÙ„Ù‹Ø§ØŸ", type:"select", options:["Ù†Ø¹Ù…","Ù„Ø§"], default:"Ù„Ø§"},
  {text:"Ø£Ø¹Ø±Ø§Ø¶ Ø¬ÙØ§Ù (ØµØ¯Ø§Ø¹/ØªØ¹Ø¨/ØªØ´Ù†Ø¬Ø§Øª)ØŸ", type:"select", options:["Ù†Ø¹Ù…","Ù„Ø§"], default:"Ù„Ø§"},
  {text:"Ù…ØªÙˆØ³Ø· Ù…Ø¹Ø¯Ù„ Ø¶Ø±Ø¨Ø§Øª Ø§Ù„Ù‚Ù„Ø¨ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠÙ† (BPM)", type:"number", min:0, max:220, default:0},
  {text:"ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸ (HH:MM)", type:"time", default:"06:00"},
  {text:"ÙˆÙ‚Øª Ø§Ù„Ù†ÙˆÙ… (HH:MM)", type:"time", default:"22:30"}
];

// === Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ===
const container = document.getElementById('questionContainer');
let answers = [];
let lastAnsweredIndex = -1;

function createQuestionElement(obj, index){
  const div = document.createElement('div');
  div.classList.add('question');
  const wrapper = document.createElement('div');
  wrapper.classList.add('input-container');

  let input;
  if(obj.type==="select"){
    input = document.createElement('select');
    const placeholder = document.createElement('option');
    placeholder.value = "";
    placeholder.disabled = true;
    placeholder.selected = true;
    placeholder.textContent = obj.text;
    placeholder.style.color = "rgba(0,255,255,0.6)";
    input.appendChild(placeholder);
    obj.options.forEach(opt=>{
      const option = document.createElement('option');
      option.value = opt;
      option.textContent = opt;
      input.appendChild(option);
    });
    input.addEventListener('change', handleSelect);
  } else {
    input = document.createElement('input');
    input.type = obj.type==="time"?"time":obj.type;
    input.placeholder = obj.text;
    if(obj.type==="time"){ input.addEventListener('change', handleTimeChange); }
    else { input.addEventListener('keypress', handleEnter); }
    if(obj.default!==undefined) input.value=obj.default;
  }

  input.setAttribute('data-index', index);
  wrapper.appendChild(input);
  div.appendChild(wrapper);
  return div;
}

function validateInput(value, obj){
  if(obj.type==="number"){
    const num=parseFloat(value);
    if(isNaN(num)) return false;
    if(obj.min!==undefined && num<obj.min) return false;
    if(obj.max!==undefined && num>obj.max) return false;
  }
  if(obj.type==="select") return obj.options.includes(value);
  if(obj.type==="time") return /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/.test(value.trim());
  return true;
}

function handleEnter(e){
  if(e.key==='Enter'){
    const idx=parseInt(e.target.getAttribute('data-index'));
    const q=questions[idx];
    const val=e.target.value;
    if(!validateInput(val,q)){ alert("âš ï¸ Ø¥Ø¯Ø®Ø§Ù„ ØºÙŠØ± ØµØ§Ù„Ø­."); e.target.focus(); return; }
    answers[idx]=val;
    if(idx>lastAnsweredIndex){ lastAnsweredIndex=idx; nextQuestion(idx); }
  }
}
function handleSelect(e){ const idx=parseInt(e.target.getAttribute('data-index')); const val=e.target.value; answers[idx]=val; if(idx>lastAnsweredIndex){ lastAnsweredIndex=idx; nextQuestion(idx); } }
function handleTimeChange(e){ const idx=parseInt(e.target.getAttribute('data-index')); const val=e.target.value; if(!validateInput(val, questions[idx])){ alert("âš ï¸ Ø¥Ø¯Ø®Ø§Ù„ ØºÙŠØ± ØµØ§Ù„Ø­."); e.target.focus(); return; } answers[idx]=val; if(idx>lastAnsweredIndex){ lastAnsweredIndex=idx; nextQuestion(idx); } }

function nextQuestion(idx){
  let nextIndex=idx+1;
  while(nextIndex<questions.length){
    const nextQ=questions[nextIndex];
    if(!nextQ.condition || nextQ.condition(answers)) break;
    nextIndex++;
  }
  if(nextIndex<questions.length){
    const nextElem=createQuestionElement(questions[nextIndex],nextIndex);
    container.appendChild(nextElem);
    setTimeout(()=>nextElem.classList.add('show'),50);
    nextElem.querySelector('input,select').focus();
    nextElem.scrollIntoView({behavior:'smooth', block:'end'});
  } else { showResult(); }
}

const firstQ=createQuestionElement(questions[0],0);
container.appendChild(firstQ);
setTimeout(()=>firstQ.classList.add('show'),50);
firstQ.querySelector('input,select').focus();

// === Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ===
function showResult(){
  let user={}; questions.forEach((q,i)=>{user[i]=answers[i];});
  let base = parseFloat(user[2]*0.033*0.94);
  if(user[4] && parseFloat(user[4])<15) base+=base*0.05;
  if(user[1]==="Ø§Ù†Ø«Ù‰") base-=base*0.10;
  if(user[0]>40) base+=0.05;
  base += (parseFloat(user[6]||3)*0.2)+((parseFloat(user[7]||45)/60)*0.8);
  if(parseFloat(user[8]||6)>7 || parseFloat(user[44]||0)>150) base*=1.12;
  if(user[9]==="Ù†Ø¹Ù…" && user[10] && user[11]){
    let sweat=(parseFloat(user[10])-parseFloat(user[11]))+parseFloat(user[13]||0);
    base += sweat*(parseFloat(user[6]||3)/7);
  }
  if(parseFloat(user[22]||0)>400) base+=0.2;
  if(user[19]==="Ù†Ø¹Ù…") base+=0.7;
  if(user[20] && user[20].toLowerCase().includes("creat")) base+=0.25;
  if(parseFloat(user[29]||7)<7 || user[30]==="Ù†Ø¹Ù…") base+=0.2;
  if(user[34]==="ØºØ§Ù…Ù‚") base+=0.5;
  if(user[36]==="Ù†Ø¹Ù…") base+=0.4;
  base=Math.max(2.0, Math.min(base,6.0));
  base=Math.round(base*100)/100;

  const div=document.createElement('div');
  div.classList.add('result-card');
  div.innerHTML=`<strong>ğŸ’§ Ø§Ù„ØªØ±Ø·ÙŠØ¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ø§Ù„Ù…Ù‚Ø¯Ø±:</strong> ${base} Ù„ØªØ±/ÙŠÙˆÙ…`;
  container.appendChild(div);
  setTimeout(()=>div.classList.add('show'),50);
  div.scrollIntoView({behavior:'smooth', block:'end'});

  const wake_time=user[45]||"06:00";
  const sleep_time=user[46]||"22:30";
  let total_ml = base*1000;
  const wake_dt=new Date(); wake_dt.setHours(parseInt(wake_time.split(":"[0])),parseInt(wake_time.split(":"[1])),0,0);
  const sleep_dt=new Date(); sleep_dt.setHours(parseInt(sleep_time.split(":"[0])),parseInt(sleep_time.split(":"[1])),0,0);
  if(sleep_dt<wake_dt) sleep_dt.setDate(sleep_dt.getDate()+1);
  const total_minutes=(sleep_dt-wake_dt)/60000;

  const windows = [
    ["Ø§Ø³ØªÙŠÙ‚Ø§Ø¸",0.20], ["ØªØ­Ø¶ÙŠØ± Ø§Ù„ØµØ¨Ø§Ø­",0.06], ["Ø¥ÙØ·Ø§Ø±",0.14], ["Ø³Ù†Ø§Ùƒ ØµØ¨Ø§Ø­ÙŠ",0.06],
    ["ØºØ¯Ø§Ø¡",0.14], ["Ø³Ù†Ø§Ùƒ Ø¨Ø¹Ø¯ Ø§Ù„Ø¸Ù‡Ø±",0.09], ["Ù‚Ø¨Ù„ Ø§Ù„ØªÙ…Ø±ÙŠÙ†",0.06],
    ["Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠÙ†",0.14], ["Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠÙ†",0.09], ["Ø¹Ø´Ø§Ø¡",0.11], ["Ø³Ù†Ø§Ùƒ Ù…Ø³Ø§Ø¦ÙŠ",0.05],
    ["Ù‚Ø¨Ù„ Ø§Ù„Ù†ÙˆÙ…",0.05]
  ];

  let scheduleDiv=document.createElement('div');
  scheduleDiv.classList.add('schedule-card');
  scheduleDiv.id = "scheduleCard";
  scheduleDiv.innerHTML="<strong>ğŸ•’ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±Ø·ÙŠØ¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ:</strong><br><br>";
  let current_time = new Date(wake_dt);
  const interval = total_minutes/windows.length;

  windows.forEach(w=>{
    const t = new Date(current_time);
    const ml=Math.round(total_ml*w[1]);
    const line = document.createElement('div');
    line.style.margin = "6px 0";
    line.style.display = "flex";
    line.style.justifyContent = "space-between";
    line.style.gap = "10px";
    line.innerHTML = `<span style="opacity:0.9;">${t.getHours().toString().padStart(2,'0')}:${t.getMinutes().toString().padStart(2,'0')}</span>
                      <span style="flex:1;text-align:center;font-weight:600">${w[0]}</span>
                      <span style="opacity:0.9;">${ml} ml</span>`;
    scheduleDiv.appendChild(line);
    current_time.setMinutes(current_time.getMinutes()+interval);
  });

  const btn = document.createElement("button");
  btn.classList.add("download-btn");
  btn.setAttribute("title", "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒØµÙˆØ±Ø©");
  btn.innerHTML = "â¬‡ï¸";

  btn.addEventListener("click", async () => {
    try {
      btn.classList.add("busy");
      btn.innerHTML = "â³";

      // Ø­ÙØ¸ Ø§Ù„Ø³ØªÙŠÙ„Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø«Ù… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø¸Ù„Ø§Ù„ ÙˆØ§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙŠ Ù‚Ø¯ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø©
      const prevBoxShadow = scheduleDiv.style.boxShadow;
      const prevTransform = scheduleDiv.style.transform;
      const prevFilter = scheduleDiv.style.filter;
      scheduleDiv.style.boxShadow = 'none';
      scheduleDiv.style.transform = 'none';
      scheduleDiv.style.filter = 'none';

      // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù‚ÙŠØ§Ø³ Ù…Ù†Ø§Ø³Ø¨ Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„/Ø±ÙŠØªÙŠÙ†Ø§
      const dpr = window.devicePixelRatio || 1;
      const scale = Math.max(2, Math.round(3 * dpr));

      const opts = {
        scale: scale,
        useCORS: true,
        backgroundColor: "#000000",
        scrollY: -window.scrollY,
        windowWidth: document.documentElement.clientWidth,
        windowHeight: document.documentElement.clientHeight
      };

      const canvas = await html2canvas(scheduleDiv, opts);

      // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø³ØªÙŠÙ„Ø§Øª
      scheduleDiv.style.boxShadow = prevBoxShadow;
      scheduleDiv.style.transform = prevTransform;
      scheduleDiv.style.filter = prevFilter;

      // ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ blob Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙ†Ø²ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„
      canvas.toBlob((blob) => {
        if(!blob){
          alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ù„Ù.');
          btn.classList.remove('busy'); btn.innerHTML = 'â¬‡ï¸';
          return;
        }
        const now = new Date();
        const pad = n=>n.toString().padStart(2,'0');
        const fname = `hydration_${now.getFullYear()}${pad(now.getMonth()+1)}${pad(now.getDate())}_${pad(now.getHours())}${pad(now.getMinutes())}.png`;

        // Ø¯Ø¹Ù… Ù…ØªØµÙØ­ IE
        if(window.navigator && window.navigator.msSaveOrOpenBlob){
          window.navigator.msSaveOrOpenBlob(blob, fname);
          btn.innerHTML = 'âœ…';
          setTimeout(()=>{ btn.innerHTML='â¬‡ï¸'; btn.classList.remove('busy'); },1200);
          return;
        }

        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = fname;
        document.body.appendChild(link);
        link.click();
        link.remove();
        URL.revokeObjectURL(url);

        btn.innerHTML = 'âœ…';
        setTimeout(()=>{ btn.innerHTML='â¬‡ï¸'; btn.classList.remove('busy'); },1200);
      }, 'image/png', 1.0);

    } catch (err) {
      console.error(err);
      alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØµÙˆØ±Ø©.');
      btn.classList.remove('busy'); btn.innerHTML = 'â¬‡ï¸';
    }
  });

  scheduleDiv.appendChild(btn);
  container.appendChild(scheduleDiv);
  setTimeout(()=>scheduleDiv.classList.add('show'),50);
  scheduleDiv.scrollIntoView({behavior:'smooth', block:'end'});
}
</script>
</body>
</html>